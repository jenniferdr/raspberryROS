/Secciones de la camara 
/* 
 * 1 central
 * 2 Izquierda
 * 3 Derecha
*/

#include "CamMedio.hpp"
#include "CamDerecha.hpp"

 
CamaMedio::CamMedio(){
  Arbotix::peticion("y");
  this->imgOriginal = Camara::obtenerImagen();
  mostrarImagen();
  
}

void CamMedio::mostrarImagen(){
  cv::Size sizeImgOrig = this->imgOriginal.size();
  cv::Mat imgLines = cv::Mat::zeros(  sizeImgOrig , CV_8UC3 );

  // Puntos para seccionar la imagen
/*   ______________________
 *  |    "           "    |
 *  |    "           "    |
 *  |L1->"      L2-> "    |
 *  |    "           "    |
 *  |    "           "    |
 *  |____"___________"____|
 *
 */

  // L1
  verticalIni = cvPoint(imgLines.size().width*3/12,0);
  verticalFin =
    cvPoint(imgLines.size().width*3/12,(imgLines.size().height));
  // L2
  verticalIni2 = cvPoint(imgLines.size().width*2/3,0);
  verticalFin2 =
    cvPoint(imgLines.size().width*2/3,imgLines.size().height);


  // Dibujar division de la pantalla
  // L1
  line(imgLines, verticalIni, verticalFin, cvScalar(0,255,0), 1);
  // L2
  line(imgLines, verticalIni2, verticalFin2, cvScalar(0,255,0), 1);

  imgOriginal = imgOriginal + imgLines;
  imshow("Original", imgOriginal);
  cv::waitKey(10);

}


// Devuelve true si ubicÃ³ la pelota en alguna camara
// Devuelve false si no la vio en ninguna camara 
bool CamMedio::ubicarPelota(){

  if (detectorPelota::esVisible(this->imgOriginal)){
    int estado = cuadrantePelota();
	return true;

  } else {
    CamDerecha camSiguiente;
    return camSiguiente.ubicarPelota();
  }

}

int CamMedio::cuadrantePelota(){
  detectorPelota::obtenerPosicion(this->posX,this->posY);

  if (estaEnIzquierda()){
    return 2; 
  }else if(estaEnCentro()){
    return 1;
  }else if(estaEnDerecha()){
    return 3;
  }
}

bool CamMedio::estaEnCentro(){
  
  if (this->posX > verticalIni.x 
      && this->posX < verticalIni2.x ){

    return true;
  }
  return false;
}

bool CamMedio::estaEnDerecha(){
  
  if (this->posX > verticalIni2.x){
    return true;
  }
  return false;
}

bool CamMedio::estaEnIzquierda(){
  
  if (this->posX < verticalIni.x){
    return true;
  }
  return false;
}


}






